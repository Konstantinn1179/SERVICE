# Инструкция по деплою в Timeweb Cloud (App Platform)

## 1. Подготовка
Убедитесь, что все изменения закоммичены и отправлены в ваш репозиторий GitHub (или вы будете загружать код вручную).

## 2. Создание приложения в Timeweb Cloud
1. Зайдите в панель управления Timeweb Cloud.
2. Перейдите в раздел **Apps**.
3. Нажмите **Создать приложение**.
4. Выберите источник: **GitHub** (рекомендуется) или **Docker Hub** / **Git**.
   - Если GitHub: подключите аккаунт и выберите репозиторий `ЦЕНТ-АКПП`.

## 3. Настройка сборки
- **Dockerfile**: Выберите опцию сборки через **Dockerfile**.
- **Путь к Dockerfile**: Оставьте `/Dockerfile` (он лежит в корне).
- **Контекст сборки**: `.` (корневая папка).
- **Порт**: `5000` (наше приложение слушает этот порт).
- **Регион**: Выберите ближайший (например, ru-1).

## 4. Переменные окружения (Environment Variables)
В разделе "Переменные окружения" добавьте следующие ключи и значения (скопируйте их из вашего локального `.env`):

| Ключ | Значение | Описание |
|------|----------|----------|
| `PORT` | `5000` | Порт сервера |
| `DATABASE_URL` | `postgres://...` | Строка подключения к базе Timeweb |
| `TELEGRAM_BOT_TOKEN` | `...` | Токен вашего бота |
| `ADMIN_CHAT_ID` | `698687960` | Ваш ID в Telegram для уведомлений |
| `WEB_APP_URL` | `https://<ваш-домен>.twc1.net` | URL, который выдаст Timeweb после создания (можно добавить позже) |
| `OPENROUTER_API_KEY` | `sk-or-...` | Ключ для AI (если используется) |
| `NODE_ENV` | `production` | Режим работы |

> **Важно:** `WEB_APP_URL` нужно будет обновить в BotFather, чтобы кнопка "Открыть приложение" вела на новый сайт, а не на localhost/serveo.

## 5. Запуск
Нажмите **Создать приложение**. Timeweb начнет сборку Docker-образа и запуск контейнера. Это займет несколько минут.

## 6. Проверка
После успешного деплоя вы получите публичный URL (например, `https://app-xxxx.twc1.net`).
1. Откройте этот URL в браузере — вы должны увидеть ваше приложение.
2. Обновите `WEB_APP_URL` в настройках приложения в Timeweb.
3. Зайдите в BotFather в Telegram:
   - `/mybots` -> Выберите бота -> **Bot Settings** -> **Menu Button** -> **Configure Menu Button** -> Отправьте новый URL.

## 7. База данных
Убедитесь, что ваша база данных в Timeweb доступна для подключений извне (или из внутренней сети Apps, если они в одном регионе).
- Если база "Managed PostgreSQL" в Timeweb:
  - В настройках базы разрешите доступ для IP-адресов приложения (или `0.0.0.0/0` для теста, но с надежным паролем).
  - Убедитесь, что SSL режим в строке подключения соответствует настройкам (`sslmode=require` или `no-verify`).
